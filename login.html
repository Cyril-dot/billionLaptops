<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In — VoltEdge</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#0a235a;--blue-mid:#1a3a7a;--blue-pale:#f0f4fc;
  --black:#000000;--off-black:#0f0f0f;--white:#ffffff;
  --grey-light:#f5f7fa;--grey-mid:#eaeef2;--text-muted:#3a3a3a;
  --danger:#dc2626;
  --shadow-md:0 6px 24px rgba(10,35,90,.12);
  --shadow-lg:0 18px 48px rgba(10,35,90,.18);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--grey-light);color:var(--black);min-height:100vh;}
a{text-decoration:none;color:inherit;}
button{font-family:'DM Sans',sans-serif;cursor:pointer;}

/* ── NAV ── */
nav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:1rem 4%;background:rgba(255,255,255,0.94);backdrop-filter:blur(14px);border-bottom:1px solid var(--grey-mid);transition:padding 0.3s;gap:.5rem;}
.nav-logo{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:600;color:var(--blue);text-decoration:none;letter-spacing:-0.01em;white-space:nowrap;flex-shrink:0;}
.nav-logo span{color:var(--black);}
.nav-links{display:flex;gap:2rem;list-style:none;}
.nav-links a{text-decoration:none;color:var(--off-black);font-size:0.9rem;font-weight:450;transition:color 0.2s;position:relative;}
.nav-links a::after{content:'';position:absolute;bottom:-3px;left:0;width:0;height:1.5px;background:var(--blue);transition:width 0.2s;}
.nav-links a:hover{color:var(--blue);}
.nav-links a:hover::after{width:100%;}
.nav-cta{background:var(--blue);color:var(--white);border:none;padding:0.5rem 1.3rem;border-radius:40px;font-size:0.8rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background 0.2s,transform 0.15s;text-decoration:none;white-space:nowrap;flex-shrink:0;}
.nav-cta:hover{background:var(--blue-mid);transform:translateY(-1px);}

/* Hamburger */
.hamburger{display:none;flex-direction:column;justify-content:center;gap:5px;background:none;border:none;cursor:pointer;padding:.3rem;flex-shrink:0;}
.hamburger span{display:block;width:22px;height:2px;background:var(--blue);border-radius:2px;transition:all .25s;}
.hamburger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
.hamburger.open span:nth-child(2){opacity:0;}
.hamburger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}
.mobile-nav-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:99;opacity:0;pointer-events:none;transition:opacity .25s;}
.mobile-nav-overlay.open{opacity:1;pointer-events:all;}
.mobile-nav-drawer{position:absolute;top:0;right:0;width:min(270px,82vw);height:100%;background:#fff;padding:5rem 1.5rem 2rem;display:flex;flex-direction:column;gap:.3rem;transform:translateX(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:-4px 0 24px rgba(0,0,0,.1);}
.mobile-nav-overlay.open .mobile-nav-drawer{transform:translateX(0);}
.mobile-nav-drawer a{padding:.6rem .85rem;border-radius:10px;font-size:.92rem;color:var(--off-black);font-weight:500;}
.mobile-nav-drawer a:hover{background:var(--grey-light);color:var(--blue);}
.nav-right{display:flex;align-items:center;gap:.5rem;}

@media(max-width:800px){
  .nav-links{display:none;}
  .hamburger{display:flex;}
  .mobile-nav-overlay{display:block;}
}

/* ── PAGE BODY ── */
.page-body{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  padding:5rem 1rem 3rem;
  background:linear-gradient(135deg,#f0f4fc 0%,#e8eef8 50%,#f5f7fa 100%);
  position:relative;overflow:hidden;
}
.page-body::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse at top left,rgba(10,35,90,.06) 0%,transparent 60%),
             radial-gradient(ellipse at bottom right,rgba(10,35,90,.04) 0%,transparent 60%);
  pointer-events:none;
}

/* Card */
.auth-card{
  background:#fff;border-radius:28px;padding:2.5rem;width:100%;max-width:420px;
  box-shadow:var(--shadow-lg);border:1px solid var(--grey-mid);
  position:relative;z-index:1;
}

/* Header */
.auth-logo{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:600;color:var(--blue);text-align:center;margin-bottom:.35rem;}
.auth-logo span{color:var(--black);}
.auth-title{font-family:'Playfair Display',serif;font-size:1.6rem;font-weight:500;text-align:center;color:var(--black);margin-bottom:.4rem;}
.auth-sub{font-size:.88rem;color:var(--text-muted);text-align:center;margin-bottom:2rem;font-weight:300;}
.auth-sub a{color:var(--blue);font-weight:600;}
.auth-sub a:hover{text-decoration:underline;}

/* Fields */
.field-group{margin-bottom:1.2rem;}
.field-group label{display:block;font-size:.78rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.45rem;}
.field-wrap{position:relative;}
.field-wrap .field-icon{position:absolute;left:.9rem;top:50%;transform:translateY(-50%);color:#aaa;font-size:.9rem;}
.field-input{
  width:100%;padding:.75rem 1rem .75rem 2.5rem;
  border:1.5px solid var(--grey-mid);border-radius:14px;
  font-family:'DM Sans',sans-serif;font-size:.92rem;outline:none;
  background:var(--grey-light);color:var(--black);
  transition:border-color .2s,box-shadow .2s,background .2s;
}
.field-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(10,35,90,.08);background:#fff;}
.field-input::placeholder{color:#bbb;}
.toggle-pw{position:absolute;right:.9rem;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#aaa;font-size:.9rem;transition:color .2s;}
.toggle-pw:hover{color:var(--blue);}

/* Error */
.error-msg{background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:.7rem 1rem;border-radius:10px;font-size:.83rem;margin-bottom:1rem;display:none;align-items:center;gap:.5rem;}
.error-msg.show{display:flex;}

/* Submit */
.submit-btn{
  width:100%;background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);
  color:#fff;border:none;padding:.9rem;border-radius:40px;
  font-family:'DM Sans',sans-serif;font-size:.95rem;font-weight:700;
  cursor:pointer;transition:all .2s;
  box-shadow:0 4px 16px rgba(10,35,90,.3);margin-top:.5rem;
}
.submit-btn:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(10,35,90,.4);}
.submit-btn:active{transform:translateY(0);}
.submit-btn:disabled{background:var(--grey-mid);color:var(--text-muted);box-shadow:none;transform:none;cursor:not-allowed;}

/* Register link */
.register-link{text-align:center;font-size:.88rem;color:var(--text-muted);margin-top:1.2rem;}
.register-link a{color:var(--blue);font-weight:600;}
.register-link a:hover{text-decoration:underline;}

/* Debug box */
#debugBox{background:var(--grey-light);padding:1rem;font-size:.75rem;display:none;word-break:break-all;white-space:pre-wrap;margin-top:1rem;border:1px solid var(--grey-mid);border-radius:10px;color:var(--text-muted);}

/* ── RESPONSIVE ── */
@media(max-width:480px){
  .auth-card{padding:1.8rem 1.2rem;border-radius:20px;}
  .auth-title{font-size:1.35rem;}
  .auth-logo{font-size:1.3rem;}
}
</style>
</head>
<body>

<!-- NAV -->
<nav id="mainNav">
  <a href="index.html" class="nav-logo">Volt<span>Edge</span></a>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="product.html">Products</a></li>
    <li><a href="newArrivals.html">New Arrivals</a></li>
    <li><a href="index.html#categories">Categories</a></li>
  </ul>
  <div class="nav-right">
    <a href="product.html" class="nav-cta">Shop Now</a>
    <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
  </div>
</nav>

<div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="closeMobileNav(event)">
  <div class="mobile-nav-drawer">
    <a href="index.html">Home</a>
    <a href="product.html">Products</a>
    <a href="newArrivals.html">New Arrivals</a>
    <a href="index.html#categories">Categories</a>
    <a href="product.html" style="margin-top:.5rem;background:var(--blue);color:#fff;border-radius:40px;text-align:center;padding:.65rem;">Shop Now</a>
  </div>
</div>

<script>
window.addEventListener('scroll',()=>{document.getElementById('mainNav').style.padding=window.scrollY>40?'0.7rem 4%':'1rem 4%';});
if(localStorage.getItem('token')&&localStorage.getItem('role')==='USER'){window.location.href='product.html';}
const ham=document.getElementById('hamburger');
const mno=document.getElementById('mobileNavOverlay');
ham.addEventListener('click',()=>{const o=mno.classList.toggle('open');ham.classList.toggle('open',o);});
function closeMobileNav(e){if(e.target===mno){mno.classList.remove('open');ham.classList.remove('open');}}
</script>

<div class="page-body">
  <div class="auth-card">
    <div class="auth-logo">Volt<span>Edge</span></div>
    <h1 class="auth-title">Welcome back</h1>
    <p class="auth-sub">Don't have an account? <a href="register.html">Create one</a></p>

    <div class="error-msg" id="errorMsg">
      <i class="fas fa-exclamation-circle"></i>
      <span id="errorText">Invalid email or password.</span>
    </div>

    <div class="field-group">
      <label for="email">Email address</label>
      <div class="field-wrap">
        <i class="fas fa-envelope field-icon"></i>
        <input type="email" class="field-input" id="email" required placeholder="you@example.com" autocomplete="email">
      </div>
    </div>

    <div class="field-group">
      <label for="password">Password</label>
      <div class="field-wrap">
        <i class="fas fa-lock field-icon"></i>
        <input type="password" class="field-input" id="password" required placeholder="••••••••" autocomplete="current-password">
        <button type="button" class="toggle-pw" id="togglePw" title="Show/hide password">
          <i class="fas fa-eye" id="eyeIcon"></i>
        </button>
      </div>
    </div>

    <button class="submit-btn" id="submitBtn">Sign In</button>

    <div class="register-link">
      New to VoltEdge? <a href="register.html">Create an account →</a>
    </div>

    <pre id="debugBox"></pre>
  </div>
</div>

<script>
const API_BASE='https://billionbackend.onrender.com/api/v1';
document.getElementById('togglePw').addEventListener('click',()=>{const pw=document.getElementById('password');const icon=document.getElementById('eyeIcon');const isText=pw.type==='text';pw.type=isText?'password':'text';icon.className=isText?'fas fa-eye':'fas fa-eye-slash';});
document.getElementById('password').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('submitBtn').click();});
document.getElementById('email').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('password').focus();});
function extractToken(d){return d.token||d.accessToken||d.access_token||d.jwt||d.jwtToken||d.authToken||null;}
function extractRole(d){return d.role||d.userRole||d.authorities||null;}
function extractUserId(d){return d.userId||d.id||d.customerId||(d.user&&d.user.id)||null;}
function extractName(d){if(d.firstName)return(d.firstName+' '+(d.lastName||'')).trim();if(d.name)return d.name;if(d.userName)return d.userName;if(d.username)return d.username;return null;}
document.getElementById('submitBtn').addEventListener('click',async()=>{
  const btn=document.getElementById('submitBtn');
  const errEl=document.getElementById('errorMsg');const errText=document.getElementById('errorText');const dbg=document.getElementById('debugBox');
  btn.disabled=true;btn.textContent='Signing in…';errEl.classList.remove('show');dbg.style.display='none';
  const payload={email:document.getElementById('email').value.trim(),password:document.getElementById('password').value};
  try{
    const res=await fetch(`${API_BASE}/auth/user/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!res.ok){const err=await res.json().catch(()=>({}));throw new Error(err.message||'Invalid email or password');}
    const data=await res.json();
    const raw=JSON.stringify(data,null,2);
    console.log('=== FULL LOGIN RESPONSE ===\n',raw);
    dbg.textContent='=== Raw server response ===\n\n'+raw;dbg.style.display='block';
    const token=extractToken(data);const role=extractRole(data);const userId=extractUserId(data);const name=extractName(data);
    if(!token){dbg.textContent='❌ Token NOT found in response!\n\nFull response:\n'+raw+'\n\nShare this output.';throw new Error('Server did not return a recognisable token. See debug box below.');}
    ['token','role','userId','userName'].forEach(k=>localStorage.removeItem(k));
    localStorage.setItem('token',token);if(role)localStorage.setItem('role',role);if(userId)localStorage.setItem('userId',String(userId));if(name)localStorage.setItem('userName',name);
    const params=new URLSearchParams(window.location.search);
    window.location.href=params.get('redirect')||'product.html';
  }catch(err){
    errText.textContent=err.message;errEl.classList.add('show');
    btn.disabled=false;btn.textContent='Sign In';
  }
});
</script>
</body>
</html>