<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product ‚Äî VoltEdge</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<style>
:root{
  --blue:#0a235a;--blue-mid:#1a3a7a;--blue-light:#e8eef8;--blue-pale:#f0f4fc;
  --black:#000000;--off-black:#0f0f0f;--white:#ffffff;
  --grey-light:#f5f7fa;--grey-mid:#eaeef2;--text-muted:#3a3a3a;
  --success:#16a34a;--danger:#dc2626;
  --shadow-sm:0 1px 4px rgba(10,35,90,.06);
  --shadow-md:0 6px 24px rgba(10,35,90,.12);
  --shadow-lg:0 18px 48px rgba(10,35,90,.18);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--grey-light);color:var(--black);overflow-x:hidden;}
a{text-decoration:none;color:inherit;}
button{font-family:'DM Sans',sans-serif;cursor:pointer;}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:1rem 4%;background:rgba(255,255,255,0.94);backdrop-filter:blur(14px);border-bottom:1px solid var(--grey-mid);transition:padding 0.3s;gap:.5rem;}
.nav-logo{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:600;color:var(--blue);text-decoration:none;letter-spacing:-0.01em;white-space:nowrap;flex-shrink:0;}
.nav-logo span{color:var(--black);}
.nav-links{display:flex;gap:2rem;list-style:none;}
.nav-links a{text-decoration:none;color:var(--off-black);font-size:0.9rem;font-weight:450;transition:color 0.2s;position:relative;}
.nav-links a::after{content:'';position:absolute;bottom:-3px;left:0;width:0;height:1.5px;background:var(--blue);transition:width 0.2s;}
.nav-links a:hover{color:var(--blue);}
.nav-links a:hover::after{width:100%;}
.nav-cta{background:var(--blue);color:var(--white);border:none;padding:0.5rem 1.3rem;border-radius:40px;font-size:0.8rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background 0.2s,transform 0.15s;text-decoration:none;white-space:nowrap;flex-shrink:0;}
.nav-cta:hover{background:var(--blue-mid);transform:translateY(-1px);}
.nav-right-area{display:flex;align-items:center;gap:.7rem;flex-shrink:0;}
.nav-cart-btn{position:relative;background:none;border:none;font-size:1.1rem;padding:.4rem;border-radius:8px;transition:background .2s;cursor:pointer;}
.nav-cart-btn:hover{background:var(--grey-light);}
.cart-badge{position:absolute;top:-4px;right:-4px;background:var(--blue);color:#fff;width:16px;height:16px;border-radius:50%;font-size:.6rem;display:flex;align-items:center;justify-content:center;font-weight:700;}

/* Hamburger */
.hamburger{display:none;flex-direction:column;justify-content:center;gap:5px;background:none;border:none;cursor:pointer;padding:.3rem;flex-shrink:0;}
.hamburger span{display:block;width:22px;height:2px;background:var(--blue);border-radius:2px;transition:all .25s;}
.hamburger.open span:nth-child(1){transform:translateY(7px) rotate(45deg);}
.hamburger.open span:nth-child(2){opacity:0;}
.hamburger.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);}
.mobile-nav-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:99;opacity:0;pointer-events:none;transition:opacity .25s;}
.mobile-nav-overlay.open{opacity:1;pointer-events:all;}
.mobile-nav-drawer{position:absolute;top:0;right:0;width:min(270px,82vw);height:100%;background:#fff;padding:5rem 1.5rem 2rem;display:flex;flex-direction:column;gap:.3rem;transform:translateX(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:-4px 0 24px rgba(0,0,0,.1);}
.mobile-nav-overlay.open .mobile-nav-drawer{transform:translateX(0);}
.mobile-nav-drawer a{padding:.6rem .85rem;border-radius:10px;font-size:.92rem;color:var(--off-black);font-weight:500;display:block;}
.mobile-nav-drawer a:hover{background:var(--grey-light);color:var(--blue);}
.mobile-nav-drawer .mnav-cta{margin-top:.5rem;background:var(--blue);color:#fff;border-radius:40px;text-align:center;padding:.65rem;font-weight:700;}

@media(max-width:800px){
  .nav-links{display:none;}
  .hamburger{display:flex;}
  .mobile-nav-overlay{display:block;}
}

/* ‚îÄ‚îÄ BREADCRUMB ‚îÄ‚îÄ */
.breadcrumb-bar{margin-top:64px;background:#fff;border-bottom:1px solid var(--grey-mid);padding:.65rem 4%;font-size:.78rem;color:var(--text-muted);}
.breadcrumb-bar a{color:var(--blue);}
.breadcrumb-bar a:hover{text-decoration:underline;}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.loading-overlay{display:flex;align-items:center;justify-content:center;min-height:60vh;font-size:1rem;color:var(--text-muted);gap:.8rem;}
.spinner{width:20px;height:20px;border:2px solid var(--grey-mid);border-top-color:var(--blue);border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚îÄ‚îÄ PRODUCT WRAP ‚îÄ‚îÄ */
.product-wrap{max-width:1100px;margin:0 auto;padding:2rem 4%;}
.product-top{display:grid;grid-template-columns:1fr 1fr;gap:2.5rem;margin-bottom:2.5rem;}

/* ‚îÄ‚îÄ GALLERY ‚îÄ‚îÄ */
.gallery-main{width:100%;height:400px;border-radius:20px;overflow:hidden;background:#fff;border:1px solid var(--grey-mid);display:flex;align-items:center;justify-content:center;margin-bottom:.8rem;cursor:zoom-in;position:relative;box-shadow:var(--shadow-md);}
.gallery-main img{width:100%;height:100%;object-fit:contain;transition:transform .3s;}
.gallery-main:hover img{transform:scale(1.03);}
.gallery-main .img-ph{font-size:6rem;}
.img-type-badge{position:absolute;top:.7rem;left:.7rem;background:rgba(10,35,90,.8);color:#fff;font-size:.6rem;font-weight:700;letter-spacing:.05em;text-transform:uppercase;padding:.2rem .55rem;border-radius:6px;backdrop-filter:blur(4px);pointer-events:none;}
.gallery-thumbs{display:flex;gap:.6rem;flex-wrap:wrap;}
.thumb{width:72px;height:72px;border-radius:12px;border:2px solid var(--grey-mid);overflow:hidden;cursor:pointer;background:#fff;transition:border-color .2s,box-shadow .2s;display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative;}
.thumb:hover{border-color:#9db4e8;}
.thumb.active{border-color:var(--blue);box-shadow:0 0 0 3px rgba(10,35,90,.12);}
.thumb img{width:100%;height:100%;object-fit:cover;}
.thumb.primary-thumb::after{content:'‚òÖ';position:absolute;bottom:2px;right:3px;font-size:.55rem;color:var(--blue);background:#fff;border-radius:3px;padding:0 2px;line-height:1.4;}

/* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:9000;display:none;align-items:center;justify-content:center;}
.lightbox.open{display:flex;}
.lightbox img{max-width:90vw;max-height:90vh;border-radius:12px;object-fit:contain;}
.lb-close{position:absolute;top:1.5rem;right:1.5rem;background:rgba(255,255,255,.15);border:none;color:#fff;font-size:1.4rem;width:40px;height:40px;border-radius:50%;cursor:pointer;transition:background .2s;}
.lb-close:hover{background:rgba(255,255,255,.3);}
.lb-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.15);border:none;color:#fff;font-size:1.8rem;width:44px;height:44px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s;}
.lb-nav:hover{background:rgba(255,255,255,.3);}
.lb-nav.prev{left:1.5rem;}.lb-nav.next{right:1.5rem;}
.lb-counter{position:absolute;bottom:1.2rem;left:50%;transform:translateX(-50%);color:rgba(255,255,255,.5);font-size:.78rem;}

/* ‚îÄ‚îÄ PRODUCT INFO ‚îÄ‚îÄ */
.product-info{display:flex;flex-direction:column;}
.prod-cat{display:inline-flex;align-items:center;gap:.3rem;font-size:.68rem;text-transform:uppercase;letter-spacing:.12em;color:var(--blue);font-weight:700;margin-bottom:.6rem;background:var(--blue-pale);padding:.25rem .7rem;border-radius:20px;width:fit-content;}
.prod-name{font-family:'Playfair Display',serif;font-size:clamp(1.4rem,3vw,2.1rem);font-weight:500;line-height:1.2;margin-bottom:.35rem;}
.prod-brand{font-size:.88rem;color:var(--text-muted);margin-bottom:1rem;}
.prod-price{font-size:2.2rem;font-weight:700;color:var(--blue);margin-bottom:.6rem;font-variant-numeric:tabular-nums;}
.prod-stock{display:inline-flex;align-items:center;gap:.4rem;font-size:.82rem;font-weight:600;padding:.3rem .85rem;border-radius:40px;margin-bottom:1.3rem;}
.prod-stock.in{background:#dcfce7;color:var(--success);}
.prod-stock.out{background:#fee2e2;color:var(--danger);}
.prod-desc{font-size:.9rem;color:var(--text-muted);line-height:1.75;margin-bottom:1.5rem;font-weight:300;}
.qty-row{display:flex;align-items:center;gap:.8rem;margin-bottom:1rem;flex-wrap:wrap;}
.qty-ctrl{display:flex;align-items:center;border:1.5px solid var(--grey-mid);border-radius:12px;overflow:hidden;background:#fff;}
.qty-btn{width:38px;height:40px;background:none;border:none;font-size:1.1rem;color:var(--blue);transition:background .15s;cursor:pointer;}
.qty-btn:hover{background:var(--blue-pale);}
.qty-val{width:44px;text-align:center;font-size:.95rem;font-weight:700;border:none;outline:none;background:none;color:var(--black);}
.add-cart-btn{flex:1;min-width:150px;background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);color:#fff;border:none;padding:.9rem 1.4rem;border-radius:40px;font-size:.95rem;font-weight:700;transition:all .2s;box-shadow:0 2px 10px rgba(10,35,90,.25);cursor:pointer;}
.add-cart-btn:hover{transform:translateY(-1px);box-shadow:0 4px 18px rgba(10,35,90,.35);}
.add-cart-btn:disabled{background:var(--grey-mid);color:var(--text-muted);cursor:not-allowed;box-shadow:none;transform:none;}
.prod-meta{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:auto;padding-top:1.2rem;border-top:1px solid var(--grey-mid);}
.meta-item{font-size:.82rem;padding:.4rem 0;}
.meta-item .meta-label{color:var(--text-muted);font-size:.7rem;text-transform:uppercase;letter-spacing:.06em;font-weight:600;margin-bottom:.15rem;opacity:.7;}
.meta-item .meta-val{font-weight:600;color:var(--black);}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.detail-tabs{background:#fff;border-radius:20px;overflow:hidden;border:1px solid var(--grey-mid);margin-bottom:2rem;box-shadow:var(--shadow-sm);}
.tab-heads{display:flex;border-bottom:1px solid var(--grey-mid);overflow-x:auto;scrollbar-width:none;}
.tab-heads::-webkit-scrollbar{display:none;}
.tab-head{padding:.95rem 1.5rem;font-size:.85rem;font-weight:500;color:var(--text-muted);border:none;background:none;border-bottom:2.5px solid transparent;white-space:nowrap;transition:all .2s;cursor:pointer;}
.tab-head:hover{color:var(--blue);}
.tab-head.active{color:var(--blue);border-bottom-color:var(--blue);font-weight:700;background:var(--blue-pale);}
.tab-pane{display:none;padding:1.6rem;}
.tab-pane.active{display:block;}
.img-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:.8rem;}
.img-grid-item{border-radius:12px;overflow:hidden;border:1px solid var(--grey-mid);cursor:pointer;height:120px;background:#fff;display:flex;align-items:center;justify-content:center;position:relative;transition:transform .2s,box-shadow .2s;}
.img-grid-item:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.img-grid-item img{width:100%;height:100%;object-fit:contain;}
.img-grid-item .pri-label{position:absolute;bottom:4px;left:4px;background:var(--blue);color:#fff;font-size:.55rem;font-weight:700;padding:.15rem .4rem;border-radius:4px;text-transform:uppercase;}

/* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
.chat-panel{display:flex;flex-direction:column;height:520px;}
.chat-product-header{display:flex;align-items:center;gap:.9rem;padding:.95rem 1.1rem;background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);border-radius:14px;margin-bottom:.8rem;flex-shrink:0;position:relative;overflow:hidden;}
.chat-product-header::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at top right,rgba(91,141,238,.35) 0%,transparent 65%);pointer-events:none;}
.chat-prod-img{width:52px;height:52px;border-radius:11px;object-fit:cover;border:2px solid rgba(255,255,255,.25);flex-shrink:0;background:rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;font-size:1.5rem;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.2);}
.chat-prod-img img{width:100%;height:100%;object-fit:cover;}
.chat-prod-details{flex:1;min-width:0;}
.chat-prod-label{font-size:.6rem;letter-spacing:.12em;text-transform:uppercase;color:rgba(255,255,255,.5);font-weight:600;margin-bottom:.12rem;}
.chat-prod-name{font-weight:700;font-size:.92rem;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.chat-prod-desc{font-size:.7rem;color:rgba(255,255,255,.55);margin-top:.1rem;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;}
.chat-prod-price{display:inline-flex;align-items:center;font-size:.78rem;font-weight:700;color:rgba(255,255,255,.95);margin-top:.25rem;background:rgba(255,255,255,.15);padding:.14rem .5rem;border-radius:20px;border:1px solid rgba(255,255,255,.2);}
.chat-seller-badge{background:rgba(255,255,255,.12);color:rgba(255,255,255,.85);font-size:.65rem;font-weight:600;padding:.2rem .6rem;border-radius:20px;white-space:nowrap;flex-shrink:0;display:flex;align-items:center;gap:.3rem;border:1px solid rgba(255,255,255,.18);}
.online-dot{width:6px;height:6px;border-radius:50%;background:#4ade80;}
.chat-status-bar{display:flex;align-items:center;gap:.45rem;padding:.32rem .8rem;border-radius:8px;font-size:.7rem;font-weight:500;margin-bottom:.55rem;flex-shrink:0;}
.chat-status-bar.connecting{background:#fef3c7;color:#92400e;}
.chat-status-bar.connected{background:#dcfce7;color:#166534;}
.chat-status-bar.polling{background:var(--blue-pale);color:var(--blue-mid);}
.chat-status-bar.disconnected{background:#fee2e2;color:#991b1b;}
.s-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.chat-status-bar.connecting .s-dot{background:#f59e0b;animation:blink 1s infinite;}
.chat-status-bar.connected .s-dot{background:#16a34a;}
.chat-status-bar.polling .s-dot{background:var(--blue);animation:blink 2s infinite;}
.chat-status-bar.disconnected .s-dot{background:#dc2626;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.25}}
.chat-messages{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:.6rem;padding:.2rem 0 .4rem;scrollbar-width:thin;scrollbar-color:var(--grey-mid) transparent;}
.chat-messages::-webkit-scrollbar{width:3px;}
.chat-messages::-webkit-scrollbar-thumb{background:var(--grey-mid);border-radius:3px;}
.date-sep{display:flex;align-items:center;gap:.6rem;margin:.3rem 0;}
.date-sep::before,.date-sep::after{content:'';flex:1;height:1px;background:var(--grey-mid);}
.date-sep span{font-size:.62rem;color:var(--text-muted);font-weight:600;letter-spacing:.05em;text-transform:uppercase;white-space:nowrap;opacity:.6;}
.cmsg{display:flex;flex-direction:column;max-width:78%;}
.cmsg.mine{align-self:flex-end;align-items:flex-end;}
.cmsg.theirs{align-self:flex-start;align-items:flex-start;}
.msg-sender{font-size:.62rem;color:var(--text-muted);font-weight:700;margin-bottom:.2rem;padding:0 .22rem;}
.bubble{padding:.6rem .9rem;border-radius:16px;font-size:.855rem;line-height:1.5;word-break:break-word;}
.cmsg.mine .bubble{background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);color:#fff;border-bottom-right-radius:4px;}
.cmsg.theirs .bubble{background:#fff;color:var(--black);border-bottom-left-radius:4px;box-shadow:0 1px 3px rgba(10,35,90,.08);}
.msg-meta{display:flex;align-items:center;gap:.3rem;font-size:.6rem;color:var(--text-muted);margin-top:.18rem;padding:0 .22rem;opacity:.7;}
.cmsg.mine .msg-meta{justify-content:flex-end;}
.read-tick{color:rgba(91,141,238,.9);font-size:.65rem;}
.chat-empty{color:var(--text-muted);font-size:.84rem;text-align:center;padding:2rem 0;flex:1;display:flex;align-items:center;justify-content:center;}
.chat-not-logged{text-align:center;padding:2rem 1rem;color:var(--text-muted);font-size:.88rem;}
.chat-not-logged a{color:var(--blue);font-weight:600;}
.chat-input-row{display:flex;gap:.5rem;padding-top:.7rem;border-top:1px solid var(--grey-mid);flex-shrink:0;align-items:flex-end;}
.chat-textarea{flex:1;padding:.58rem .85rem;border:1.5px solid var(--grey-mid);border-radius:12px;font-family:'DM Sans',sans-serif;font-size:.86rem;outline:none;transition:border-color .2s;resize:none;max-height:80px;line-height:1.45;background:var(--grey-light);color:var(--black);}
.chat-textarea:focus{border-color:var(--blue);background:#fff;}
.chat-textarea::placeholder{color:#aaa;}
.chat-send-btn{background:linear-gradient(135deg,var(--blue),#1e4ab5);color:#fff;border:none;width:38px;height:38px;border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;flex-shrink:0;}
.chat-send-btn:hover{transform:translateY(-1px);}
.chat-send-btn:disabled{background:var(--grey-mid);color:var(--text-muted);transform:none;cursor:not-allowed;}
.pc-bubble{background:#fff;border:1px solid var(--grey-mid);border-radius:16px;overflow:hidden;width:220px;box-shadow:var(--shadow-md);transition:transform .2s,box-shadow .2s;cursor:pointer;align-self:flex-start;text-decoration:none;display:block;}
.pc-bubble:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);}
.pc-img-wrap{position:relative;width:100%;height:112px;overflow:hidden;background:var(--blue-pale);}
.pc-img-wrap img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .3s;}
.pc-bubble:hover .pc-img-wrap img{transform:scale(1.04);}
.pc-img-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:2.4rem;}
.pc-price-badge{position:absolute;bottom:.5rem;left:.5rem;background:linear-gradient(135deg,var(--blue),#1e4ab5);color:#fff;font-size:.7rem;font-weight:700;padding:.2rem .55rem;border-radius:20px;}
.pc-body{padding:.65rem .75rem .7rem;}
.pc-name{font-weight:700;font-size:.83rem;color:var(--black);line-height:1.3;}
.pc-desc{font-size:.7rem;color:var(--text-muted);margin-top:.2rem;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.pc-footer{display:flex;align-items:center;justify-content:space-between;margin-top:.5rem;padding-top:.45rem;border-top:1px solid var(--grey-mid);}
.pc-time{font-size:.6rem;color:var(--text-muted);}
.pc-cta{font-size:.62rem;font-weight:700;color:var(--blue);display:flex;align-items:center;gap:.2rem;}

/* ‚îÄ‚îÄ RELATED ‚îÄ‚îÄ */
.related-section{margin-top:.5rem;}
.related-section h2{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:500;margin-bottom:1.1rem;}
.related-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1rem;}
.r-card{background:#fff;border-radius:18px;overflow:hidden;border:1px solid var(--grey-mid);cursor:pointer;transition:all .22s;box-shadow:var(--shadow-sm);}
.r-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);}
.r-card-img{height:120px;background:var(--grey-light);display:flex;align-items:center;justify-content:center;font-size:2.5rem;overflow:hidden;}
.r-card-img img{width:100%;height:100%;object-fit:cover;transition:transform .3s;}
.r-card:hover .r-card-img img{transform:scale(1.05);}
.r-card-body{padding:.75rem;}
.r-card-name{font-size:.82rem;font-weight:600;margin-bottom:.3rem;line-height:1.35;}
.r-card-price{font-size:.9rem;font-weight:700;color:var(--blue);}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:1.5rem;left:1rem;right:1rem;background:#fff;border:1px solid var(--grey-mid);border-radius:60px;padding:.6rem 1.5rem;font-size:.82rem;color:var(--blue);box-shadow:var(--shadow-lg);z-index:999;opacity:0;transform:translateY(16px);transition:all .3s;pointer-events:none;text-align:center;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.success{border-left:3px solid var(--success);}
.toast.error{border-left:3px solid var(--danger);}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(min-width:600px){
  .toast{left:auto;right:1.5rem;max-width:280px;text-align:left;}
}
@media(max-width:800px){
  .product-top{grid-template-columns:1fr;gap:1.5rem;}
  .gallery-main{height:320px;}
  .product-wrap{padding:1.5rem 4%;}
}
@media(max-width:560px){
  .gallery-main{height:260px;border-radius:14px;}
  .thumb{width:58px;height:58px;}
  .prod-price{font-size:1.8rem;}
  .qty-row{gap:.6rem;}
  .add-cart-btn{min-width:120px;font-size:.88rem;padding:.8rem 1rem;}
  .prod-meta{grid-template-columns:1fr 1fr;gap:.3rem;}
  .tab-head{padding:.8rem 1rem;font-size:.8rem;}
  .tab-pane{padding:1.1rem;}
  .chat-panel{height:440px;}
  .img-grid{grid-template-columns:repeat(auto-fill,minmax(110px,1fr));}
  .related-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}
}
@media(max-width:400px){
  .gallery-main{height:220px;}
  .prod-price{font-size:1.5rem;}
  .qty-row{flex-direction:column;align-items:stretch;}
  .add-cart-btn{min-width:unset;width:100%;}
  .qty-ctrl{justify-content:center;}
  .chat-panel{height:400px;}
}
</style>
</head>
<body>

<!-- NAV -->
<nav id="mainNav">
  <a href="index.html" class="nav-logo">Volt<span>Edge</span></a>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="product.html">Products</a></li>
    <li><a href="newArrivals.html">New Arrivals</a></li>
    <li><a href="index.html#categories">Categories</a></li>
  </ul>
  <div class="nav-right-area">
    <button class="nav-cart-btn" id="cartBtn" title="Cart">
      <i class="fas fa-shopping-cart" style="color:var(--blue);font-size:1rem;"></i>
      <span class="cart-badge" id="cartBadge">0</span>
    </button>
    <div id="navAuthArea"></div>
    <a href="product.html" class="nav-cta">Shop Now</a>
    <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
  </div>
</nav>

<!-- Mobile nav drawer -->
<div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="closeMobileNav(event)">
  <div class="mobile-nav-drawer">
    <a href="index.html">Home</a>
    <a href="product.html">Products</a>
    <a href="newArrivals.html">New Arrivals</a>
    <a href="index.html#categories">Categories</a>
    <a href="product.html" class="mnav-cta">Shop Now</a>
  </div>
</div>

<script>
(function(){
  const el=document.getElementById('navAuthArea');
  if(localStorage.getItem('token')){const n=localStorage.getItem('userName')||'Me';el.innerHTML=`<a href="profile.html" style="font-size:.8rem;color:var(--blue);font-weight:500;text-decoration:none;white-space:nowrap;">Hi, ${n.split(' ')[0]}</a>`;}
  else{el.innerHTML=`<a href="login.html" style="font-size:.8rem;color:var(--blue);font-weight:500;text-decoration:none;white-space:nowrap;">Sign in</a>`;}
})();
window.addEventListener('scroll',()=>{document.getElementById('mainNav').style.padding=window.scrollY>40?'0.7rem 4%':'1rem 4%';});
const ham=document.getElementById('hamburger');
const mno=document.getElementById('mobileNavOverlay');
ham.addEventListener('click',()=>{const o=mno.classList.toggle('open');ham.classList.toggle('open',o);});
function closeMobileNav(e){if(e.target===mno){mno.classList.remove('open');ham.classList.remove('open');}}
</script>

<div class="breadcrumb-bar">
  <a href="index.html">Home</a> / <a href="product.html">Products</a> / <span id="prodBreadcrumb">Loading‚Ä¶</span>
</div>
<div id="pageContent"><div class="loading-overlay"><div class="spinner"></div> Loading product‚Ä¶</div></div>
<div class="lightbox" id="lightbox">
  <button class="lb-close" id="lbClose">‚úï</button>
  <button class="lb-nav prev" id="lbPrev">‚Äπ</button>
  <img src="" id="lbImg" alt="">
  <button class="lb-nav next" id="lbNext">‚Ä∫</button>
  <div class="lb-counter" id="lbCounter"></div>
</div>
<div class="toast" id="toast"></div>

<script>
const API_BASE='https://billionbackend.onrender.com/api/v1';
const WS_URL='https://billionbackend.onrender.com/ws/chat';
const Auth={token:()=>localStorage.getItem('token'),userId:()=>localStorage.getItem('userId'),isLoggedIn:()=>!!localStorage.getItem('token'),headers:()=>{const h={'Content-Type':'application/json'};const t=localStorage.getItem('token');if(t)h['Authorization']=`Bearer ${t}`;return h;},logout:()=>{['token','userId','role','userName'].forEach(k=>localStorage.removeItem(k));window.location.reload();}};
let toastTimer;
function showToast(msg,type=''){const t=document.getElementById('toast');t.innerHTML=msg;t.className='toast show'+(type?' '+type:'');clearTimeout(toastTimer);toastTimer=setTimeout(()=>t.classList.remove('show'),3200);}
async function refreshCartCount(){if(!Auth.isLoggedIn())return;try{const r=await fetch(API_BASE+'/cart/count',{headers:Auth.headers()});if(r.ok){const c=await r.json();document.getElementById('cartBadge').textContent=c||0;}}catch{}}
refreshCartCount();
document.getElementById('cartBtn').addEventListener('click',()=>{window.location.href=Auth.isLoggedIn()?'cart.html':'login.html';});
const params=new URLSearchParams(window.location.search);
const productId=params.get('id');
if(!productId){document.getElementById('pageContent').innerHTML='<div class="loading-overlay">No product selected. <a href="product.html" style="color:var(--blue);margin-left:.5rem;">‚Üê Back</a></div>';}
const DEMO_PRODUCTS=[{id:1,name:'HP EliteBook 1030 G3/G4',category:'Laptop',brand:'HP',price:4500,stock:6,description:'13.3-inch IPS display ¬∑ 16GB RAM ¬∑ 256GB SSD ¬∑ 18-hour battery ¬∑ Intel Core i5-8th Gen.',imageUrl:'images/laptopImage1.png',imageUrls:['images/laptopImage1.png']},{id:2,name:'HP EliteBook 840 G5/G6',category:'Laptop',brand:'HP',price:3500,stock:12,description:'14-inch ¬∑ 8GB RAM ¬∑ 256GB SSD ¬∑ Titanium finish ¬∑ Intel Core i5-8th Gen.',imageUrl:'images/laptopImage2.png',imageUrls:['images/laptopImage2.png']},{id:3,name:'Dell XPS 15',category:'Laptop',brand:'Dell',price:5200,stock:5,description:'Intel i7-12th Gen ¬∑ 16GB DDR5 ¬∑ 512GB NVMe SSD ¬∑ 15.6-inch OLED 3.5K display.',imageUrl:'images/laptopImage3.png',imageUrls:['images/laptopImage3.png']}];
const CAT_EMOJI={Laptop:'üíª',Smartphone:'üì±',Accessories:'üéß'};
let product=null,allImgs=[],lbIndex=0,qty=1;
let chatRoomId=null,chatMessages=[],stompClient=null,wsConnected=false,pollInterval=null;
async function loadProduct(){
  try{const res=await fetch(`${API_BASE}/products/${productId}`);if(!res.ok)throw new Error();product=await res.json();}
  catch{product=DEMO_PRODUCTS.find(p=>String(p.id)===String(productId))||DEMO_PRODUCTS[0];}
  document.title=product.name+' ‚Äî VoltEdge';
  document.getElementById('prodBreadcrumb').textContent=product.name;
  allImgs=[];
  const urls=product.imageUrls&&product.imageUrls.length>0?product.imageUrls:(product.imageUrl?[product.imageUrl]:[]);
  urls.forEach((url,i)=>allImgs.push({url,label:i===0?'Primary':`Image ${i+1}`}));
  renderProduct();loadRelated();
}
function renderProduct(){
  const inStock=(product.stock||0)>0;
  const emoji=CAT_EMOJI[product.category]||'üì¶';
  const firstImg=allImgs[0];
  const mainImgHtml=firstImg?`<img src="${firstImg.url}" alt="${product.name}" id="mainImg"><span class="img-type-badge" id="mainBadge">${firstImg.label}</span>`:`<span class="img-ph">${emoji}</span>`;
  const thumbsHtml=allImgs.length>1?allImgs.map((img,i)=>`<div class="thumb ${i===0?'active primary-thumb':''}" data-i="${i}" title="${img.label}"><img src="${img.url}" alt="${img.label}" loading="lazy"></div>`).join(''):(firstImg?`<div class="thumb active primary-thumb" data-i="0"><img src="${firstImg.url}" alt="Primary"></div>`:'');
  const allImgsTabHtml=allImgs.length>0?`<div class="img-grid">${allImgs.map((img,i)=>`<div class="img-grid-item" data-i="${i}"><img src="${img.url}" alt="${img.label}" loading="lazy">${i===0?'<span class="pri-label">Primary</span>':''}</div>`).join('')}</div>`:`<p style="color:var(--text-muted);font-size:.88rem;">No additional images.</p>`;
  const prodImgSrc=allImgs[0]?.url||'';
  const chatHeader=`<div class="chat-product-header"><div class="chat-prod-img">${prodImgSrc?`<img src="${prodImgSrc}" alt="${product.name}">`:(CAT_EMOJI[product.category]||'üì¶')}</div><div class="chat-prod-details"><div class="chat-prod-label">Chat with Seller</div><div class="chat-prod-name">${product.name}</div><div class="chat-prod-desc">${product.description||''}</div><div class="chat-prod-price">‚Çµ${parseFloat(product.price).toLocaleString('en-GH',{minimumFractionDigits:2})}</div></div><div class="chat-seller-badge"><span class="online-dot"></span>Seller</div></div>`;
  const chatContent=Auth.isLoggedIn()?`<div class="chat-panel" id="chatPanel">${chatHeader}<div class="chat-status-bar connecting" id="chatStatusBar"><span class="s-dot"></span><span id="chatStatusText">Connecting‚Ä¶</span></div><div class="chat-messages" id="chatMessages"><div class="chat-empty">Loading messages‚Ä¶</div></div><div class="chat-input-row"><textarea class="chat-textarea" id="chatInput" rows="1" placeholder="Ask about this product‚Ä¶"></textarea><button class="chat-send-btn" id="chatSend" disabled title="Send"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button></div></div>`:`<div class="chat-not-logged">${chatHeader}<div style="margin-top:1.5rem;"><p>Please <a href="login.html?redirect=${encodeURIComponent(window.location.href)}">sign in</a> to chat with the seller.</p></div></div>`;
  const priceFormatted=parseFloat(product.price).toLocaleString('en-GH',{minimumFractionDigits:2});
  const html=`<div class="product-wrap"><div class="product-top"><div><div class="gallery-main" id="galleryMain">${mainImgHtml}</div><div class="gallery-thumbs" id="galleryThumbs">${thumbsHtml}</div></div><div class="product-info"><div class="prod-cat">${product.category}</div><h1 class="prod-name">${product.name}</h1><div class="prod-brand">by ${product.brand||'VoltEdge'}</div><div class="prod-price">‚Çµ${priceFormatted}</div><div class="prod-stock ${inStock?'in':'out'}">${inStock?`‚úì In stock (${product.stock})`:'‚úó Out of stock'}</div><p class="prod-desc">${product.description||''}</p><div class="qty-row"><div class="qty-ctrl"><button class="qty-btn" id="qtyMinus">‚àí</button><input class="qty-val" id="qtyVal" type="number" value="1" min="1" max="${product.stock||1}" readonly><button class="qty-btn" id="qtyPlus">+</button></div><button class="add-cart-btn" id="addCartBtn" ${!inStock?'disabled':''}>${inStock?'+ Add to Cart':'Out of Stock'}</button></div><div class="prod-meta"><div class="meta-item"><div class="meta-label">Category</div><div class="meta-val">${product.category}</div></div><div class="meta-item"><div class="meta-label">Brand</div><div class="meta-val">${product.brand||'‚Äî'}</div></div><div class="meta-item"><div class="meta-label">Stock</div><div class="meta-val">${product.stock??'‚Äî'}</div></div><div class="meta-item"><div class="meta-label">Product ID</div><div class="meta-val">#${product.id}</div></div></div></div></div><div class="detail-tabs"><div class="tab-heads"><button class="tab-head active" data-tab="description">Description</button><button class="tab-head" data-tab="images">üñº Images${allImgs.length>1?` (${allImgs.length})`:''}</button><button class="tab-head" data-tab="specs">Specs</button><button class="tab-head" data-tab="chat">üí¨ Ask Seller</button></div><div class="tab-pane active" id="tab-description"><p style="font-size:.92rem;line-height:1.8;color:var(--text-muted);font-weight:300;">${product.description||'No description available.'}</p></div><div class="tab-pane" id="tab-images"><p style="font-size:.78rem;color:var(--text-muted);margin-bottom:1rem;">Click any image to enlarge.</p>${allImgsTabHtml}</div><div class="tab-pane" id="tab-specs"><table style="width:100%;border-collapse:collapse;font-size:.88rem;">${[['Name',product.name],['Brand',product.brand||'‚Äî'],['Category',product.category],['Price',`‚Çµ${priceFormatted}`],['In Stock',inStock?`Yes (${product.stock})`:'No'],['Product ID',`#${product.id}`]].map(([k,v])=>`<tr style="border-bottom:1px solid var(--grey-mid);"><td style="padding:.65rem .5rem;color:var(--text-muted);width:40%;font-size:.78rem;text-transform:uppercase;letter-spacing:.04em;font-weight:600;">${k}</td><td style="padding:.65rem .5rem;font-weight:600;">${v}</td></tr>`).join('')}</table></div><div class="tab-pane" id="tab-chat">${chatContent}</div></div><div class="related-section"><h2>Related Products</h2><div class="related-grid" id="relatedGrid"><div style="color:var(--text-muted);font-size:.85rem;grid-column:1/-1;">Loading‚Ä¶</div></div></div></div>`;
  document.getElementById('pageContent').innerHTML=html;
  bindEvents();
}
function bindEvents(){
  document.getElementById('qtyMinus')?.addEventListener('click',()=>{if(qty>1){qty--;document.getElementById('qtyVal').value=qty;}});
  document.getElementById('qtyPlus')?.addEventListener('click',()=>{if(qty<(product.stock||99)){qty++;document.getElementById('qtyVal').value=qty;}});
  document.getElementById('addCartBtn')?.addEventListener('click',addToCart);
  document.querySelectorAll('.tab-head').forEach(btn=>{btn.addEventListener('click',()=>{document.querySelectorAll('.tab-head').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));btn.classList.add('active');const pane=document.getElementById('tab-'+btn.dataset.tab);if(pane)pane.classList.add('active');if(btn.dataset.tab==='chat'&&Auth.isLoggedIn())initChat();});});
  document.querySelectorAll('.thumb').forEach(t=>t.addEventListener('click',()=>setMainImage(parseInt(t.dataset.i))));
  document.getElementById('galleryMain')?.addEventListener('click',()=>{if(allImgs.length>0)openLightbox(lbIndex);});
  document.querySelectorAll('.img-grid-item').forEach(el=>el.addEventListener('click',()=>openLightbox(parseInt(el.dataset.i))));
  document.getElementById('lbClose').addEventListener('click',closeLightbox);
  document.getElementById('lightbox').addEventListener('click',e=>{if(e.target===e.currentTarget)closeLightbox();});
  document.getElementById('lbPrev').addEventListener('click',e=>{e.stopPropagation();lbIndex=(lbIndex-1+allImgs.length)%allImgs.length;updateLightbox();});
  document.getElementById('lbNext').addEventListener('click',e=>{e.stopPropagation();lbIndex=(lbIndex+1)%allImgs.length;updateLightbox();});
  document.addEventListener('keydown',e=>{if(!document.getElementById('lightbox').classList.contains('open'))return;if(e.key==='ArrowLeft'){lbIndex=(lbIndex-1+allImgs.length)%allImgs.length;updateLightbox();}if(e.key==='ArrowRight'){lbIndex=(lbIndex+1)%allImgs.length;updateLightbox();}if(e.key==='Escape')closeLightbox();});
  const chatInput=document.getElementById('chatInput');
  document.getElementById('chatSend')?.addEventListener('click',sendChatMessage);
  chatInput?.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChatMessage();}});
  chatInput?.addEventListener('input',function(){this.style.height='auto';this.style.height=Math.min(this.scrollHeight,80)+'px';});
}
function setMainImage(i){if(!allImgs[i])return;lbIndex=i;const img=allImgs[i];const main=document.getElementById('galleryMain');main.innerHTML=`<img src="${img.url}" alt="${img.label}" id="mainImg"><span class="img-type-badge">${img.label}</span>`;main.querySelector('img').addEventListener('click',()=>openLightbox(i));document.querySelectorAll('.thumb').forEach(t=>t.classList.toggle('active',parseInt(t.dataset.i)===i));}
function openLightbox(i){lbIndex=i;document.getElementById('lightbox').classList.add('open');updateLightbox();const s=allImgs.length>1;document.getElementById('lbPrev').style.display=s?'flex':'none';document.getElementById('lbNext').style.display=s?'flex':'none';}
function updateLightbox(){document.getElementById('lbImg').src=allImgs[lbIndex]?.url||'';document.getElementById('lbCounter').textContent=allImgs.length>1?`${lbIndex+1} / ${allImgs.length}`:'';}
function closeLightbox(){document.getElementById('lightbox').classList.remove('open');}
async function addToCart(){if(!Auth.isLoggedIn()){window.location.href=`login.html?redirect=${encodeURIComponent(window.location.href)}`;return;}const btn=document.getElementById('addCartBtn');btn.textContent='Adding‚Ä¶';btn.disabled=true;try{const res=await fetch(API_BASE+'/cart',{method:'POST',headers:Auth.headers(),body:JSON.stringify({productId:product.id,quantity:qty})});if(!res.ok)throw new Error();showToast(`‚úì <strong>${product.name}</strong> added to cart`,'success');refreshCartCount();}catch{showToast(`‚úì <strong>${product.name}</strong> added to cart`,'success');const b=document.getElementById('cartBadge');b.textContent=parseInt(b.textContent||0)+qty;}btn.textContent='+ Add to Cart';btn.disabled=false;}
function setChatStatus(state,text){const bar=document.getElementById('chatStatusBar');const txt=document.getElementById('chatStatusText');if(!bar||!txt)return;bar.className=`chat-status-bar ${state}`;txt.textContent=text;}
function enableSend(e){const b=document.getElementById('chatSend');if(b)b.disabled=!e;}
async function initChat(){if(!Auth.isLoggedIn())return;setChatStatus('connecting','Connecting‚Ä¶');enableSend(false);try{const res=await fetch(API_BASE+'/chat/start',{method:'POST',headers:Auth.headers(),body:JSON.stringify({productId:product.id})});if(res.ok){const d=await res.json();chatRoomId=d.chatRoomId;}}catch{}await loadChatHistory();connectWebSocket();}
async function loadChatHistory(){if(!chatRoomId){renderMsgs();return;}try{const res=await fetch(`${API_BASE}/chat/rooms/${chatRoomId}/history`,{headers:Auth.headers()});if(res.ok)chatMessages=await res.json();}catch{}renderMsgs();}
function connectWebSocket(){if(!chatRoomId){startPolling();return;}try{const sock=new SockJS(WS_URL);stompClient=Stomp.over(sock);stompClient.debug=null;stompClient.connect({'Authorization':`Bearer ${Auth.token()}`},()=>{wsConnected=true;setChatStatus('connected','Live ¬∑ messages appear instantly');enableSend(true);stopPolling();stompClient.subscribe(`/topic/user/chat/${chatRoomId}`,frame=>{try{const msg=JSON.parse(frame.body);if(!chatMessages.some(m=>m.messageId===msg.messageId)){chatMessages.push(msg);renderMsgs();}}catch{}});},err=>{wsConnected=false;stompClient=null;startPolling();});sock.onclose=()=>{if(wsConnected){wsConnected=false;stompClient=null;setChatStatus('disconnected','Reconnecting‚Ä¶');setTimeout(()=>{if(!wsConnected)connectWebSocket();},3000);}};}catch{startPolling();}}
function startPolling(){if(pollInterval)return;setChatStatus('polling','Auto-refresh every 4s');enableSend(true);pollInterval=setInterval(async()=>{if(!chatRoomId)return;try{const r=await fetch(`${API_BASE}/chat/rooms/${chatRoomId}/history`,{headers:Auth.headers()});if(!r.ok)return;const h=await r.json();if(h.length>chatMessages.length){chatMessages=h;renderMsgs();}}catch{}},4000);}
function stopPolling(){if(pollInterval){clearInterval(pollInterval);pollInterval=null;}}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function fmtT(iso){try{return new Date(iso).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}catch{return '';}}
function renderMsgs(){const el=document.getElementById('chatMessages');if(!el)return;if(!chatMessages.length){el.innerHTML='<div class="chat-empty">No messages yet ‚Äî ask the seller something!</div>';return;}let html='<div class="date-sep"><span>Today</span></div>';chatMessages.forEach(m=>{const mine=m.senderType==='USER';const t=fmtT(m.sentAt);if(m.content&&m.content.startsWith('PRODUCT_CARD::')){const parts=m.content.split('::');const pn=parts[1]||'';const pp=parts[2]||'';const pd=parts[3]||'';const pi=parts[4]||'';const pid=m.productId||productId||'';html+=`<a class="pc-bubble" href="product-detail.html?id=${esc(String(pid))}" title="View product"><div class="pc-img-wrap">${pi?`<img src="${esc(pi)}" alt="${esc(pn)}">`:`<div class="pc-img-ph">üì¶</div>`}${pp?`<div class="pc-price-badge">‚Çµ${esc(pp)}</div>`:''}</div><div class="pc-body"><div class="pc-name">${esc(pn)}</div>${pd?`<div class="pc-desc">${esc(pd)}</div>`:''}<div class="pc-footer"><span class="pc-time">${t}</span><span class="pc-cta">View ‚Üí</span></div></div></a>`;return;}html+=`<div class="cmsg ${mine?'mine':'theirs'}">${!mine?`<div class="msg-sender">${esc(m.senderName||'Seller')}</div>`:''}<div class="bubble">${esc(m.content||'')}</div><div class="msg-meta">${t}${mine?' <span class="read-tick">‚úì‚úì</span>':''}</div></div>`;});el.innerHTML=html;el.scrollTop=el.scrollHeight;}
async function sendChatMessage(){const input=document.getElementById('chatInput');const text=input?.value.trim();if(!text)return;input.value='';input.style.height='auto';enableSend(false);const opt={messageId:'tmp-'+Date.now(),senderType:'USER',senderId:Auth.userId(),senderName:localStorage.getItem('userName')||'You',content:text,isProductCard:false,sentAt:new Date().toISOString()};chatMessages.push(opt);renderMsgs();if(!chatRoomId){try{const r=await fetch(API_BASE+'/chat/start',{method:'POST',headers:Auth.headers(),body:JSON.stringify({productId:product.id})});if(r.ok){const d=await r.json();chatRoomId=d.chatRoomId;if(!wsConnected&&!stompClient)connectWebSocket();}}catch{}}let sent=false;if(wsConnected&&stompClient&&chatRoomId){try{stompClient.send(`/app/chat/${chatRoomId}/user/send`,{},JSON.stringify({senderId:Auth.userId(),content:text}));sent=true;}catch{}}if(!sent&&chatRoomId){try{const r=await fetch(`${API_BASE}/chat/rooms/${chatRoomId}/send`,{method:'POST',headers:Auth.headers(),body:JSON.stringify({content:text})});if(r.ok){const s=await r.json();chatMessages=chatMessages.filter(m=>m.messageId!==opt.messageId);chatMessages.push(s);renderMsgs();}}catch{}}enableSend(true);document.getElementById('chatInput')?.focus();}
async function loadRelated(){try{let related=[];try{const d=await fetch(`${API_BASE}/products/category/${product.category}`).then(r=>r.ok?r.json():[]);related=(Array.isArray(d)?d:[]).filter(p=>String(p.id)!==String(product.id)).slice(0,6);}catch{related=DEMO_PRODUCTS.filter(p=>p.category===product.category&&String(p.id)!==String(product.id));}const grid=document.getElementById('relatedGrid');if(!grid)return;if(!related.length){grid.innerHTML='<p style="color:var(--text-muted);font-size:.85rem;grid-column:1/-1;">No related products.</p>';return;}const emoji=CAT_EMOJI[product.category]||'üì¶';grid.innerHTML=related.map(p=>{const img=(p.imageUrls&&p.imageUrls[0])||p.imageUrl;return`<div class="r-card" onclick="window.location.href='product-detail.html?id=${p.id}'"><div class="r-card-img">${img?`<img src="${img}" alt="${p.name}" loading="lazy">`:emoji}</div><div class="r-card-body"><div class="r-card-name">${p.name}</div><div class="r-card-price">‚Çµ${parseFloat(p.price).toLocaleString('en-GH',{minimumFractionDigits:2})}</div></div></div>`;}).join('');}catch{}}
window.addEventListener('beforeunload',()=>{stopPolling();if(stompClient&&wsConnected){try{stompClient.disconnect();}catch{}}});
if(productId)loadProduct();
</script>
</body>
</html>