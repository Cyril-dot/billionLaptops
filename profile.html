<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Profile ‚Äî VoltEdge</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#0a235a;--blue-mid:#1a3a7a;--blue-pale:#f0f4fc;
  --black:#000000;--off-black:#0f0f0f;--white:#ffffff;
  --grey-light:#f5f7fa;--grey-mid:#eaeef2;--text-muted:#3a3a3a;
  --success:#16a34a;--danger:#dc2626;
  --shadow-sm:0 1px 4px rgba(10,35,90,.06);
  --shadow-md:0 6px 24px rgba(10,35,90,.12);
  --shadow-lg:0 18px 48px rgba(10,35,90,.18);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--grey-light);color:var(--black);min-height:100vh;}
a{text-decoration:none;color:inherit;}
button{font-family:'DM Sans',sans-serif;cursor:pointer;}

/* ‚ïê‚ïê NAV ‚ïê‚ïê */
nav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:1rem 4%;background:rgba(255,255,255,0.96);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);border-bottom:1px solid var(--grey-mid);transition:padding 0.3s;min-height:60px;}
.nav-logo{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:600;color:var(--blue);text-decoration:none;letter-spacing:-0.01em;white-space:nowrap;}
.nav-logo span{color:var(--black);}
.nav-links{display:flex;gap:2rem;list-style:none;}
.nav-links a{text-decoration:none;color:var(--off-black);font-size:0.9rem;font-weight:450;transition:color 0.2s;position:relative;}
.nav-links a::after{content:'';position:absolute;bottom:-3px;left:0;width:0;height:1.5px;background:var(--blue);transition:width 0.2s;}
.nav-links a:hover{color:var(--blue);}
.nav-links a:hover::after,.nav-links a.active::after{width:100%;}
.nav-links a.active{color:var(--blue);}
.nav-cta{background:var(--blue);color:var(--white);border:none;padding:0.5rem 1.3rem;border-radius:40px;font-size:0.8rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background 0.2s,transform 0.15s;text-decoration:none;white-space:nowrap;}
.nav-cta:hover{background:var(--blue-mid);transform:translateY(-1px);}
.nav-right-area{display:flex;align-items:center;gap:.7rem;}
.nav-hamburger{display:none;background:none;border:none;font-size:1.25rem;color:var(--blue);padding:.4rem;border-radius:8px;transition:background .2s;}
.nav-hamburger:hover{background:var(--grey-light);}
.nav-mobile-menu{display:none;position:fixed;top:60px;left:0;right:0;background:#fff;border-bottom:2px solid var(--blue-pale);padding:1rem 4%;z-index:99;flex-direction:column;gap:.2rem;box-shadow:0 8px 24px rgba(10,35,90,.1);}
.nav-mobile-menu.open{display:flex;}
.nav-mobile-menu a{display:block;padding:.7rem .8rem;border-radius:8px;color:var(--off-black);font-size:.9rem;font-weight:500;transition:background .15s,color .15s;}
.nav-mobile-menu a:hover,.nav-mobile-menu a.active{background:var(--blue-pale);color:var(--blue);}
.nav-mobile-menu .mobile-cta{display:inline-block;margin-top:.4rem;background:var(--blue);color:#fff;padding:.65rem 1.4rem;border-radius:40px;font-size:.85rem;font-weight:600;text-align:center;}
@media(max-width:900px){.nav-links{display:none;}.nav-hamburger{display:block;}}
@media(max-width:480px){.nav-cta{display:none;}}

/* ‚ïê‚ïê PAGE HERO ‚ïê‚ïê */
.page-hero{
  margin-top:60px;
  background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);
  padding:2.5rem 4% 2rem;color:#fff;position:relative;overflow:hidden;
}
.page-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at top right,rgba(91,141,238,.3) 0%,transparent 60%);pointer-events:none;}
.breadcrumb{font-size:.75rem;color:rgba(255,255,255,.45);margin-bottom:.8rem;}
.breadcrumb a{color:rgba(255,255,255,.6);}
.breadcrumb a:hover{color:#fff;}
.page-hero h1{font-family:'Playfair Display',serif;font-size:clamp(1.4rem,4vw,2rem);font-weight:500;}
.page-hero p{color:rgba(255,255,255,.55);margin-top:.4rem;font-size:.88rem;font-weight:300;}

/* ‚ïê‚ïê CONTENT ‚ïê‚ïê */
.profile-content{max-width:680px;margin:2rem auto;padding:0 4% 3rem;}

/* Loading / error */
.loading-wrap{display:flex;align-items:center;gap:.8rem;color:var(--text-muted);padding:3rem;justify-content:center;}
.spinner{width:20px;height:20px;border:2px solid var(--grey-mid);border-top-color:var(--blue);border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.error-banner{background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:.9rem 1.2rem;border-radius:14px;font-size:.88rem;display:none;align-items:center;gap:.5rem;}
.error-banner.show{display:flex;}

/* Avatar */
.profile-avatar-wrap{display:flex;flex-direction:column;align-items:center;margin-bottom:1.5rem;}
.avatar-circle{
  width:88px;height:88px;border-radius:50%;
  background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);
  display:flex;align-items:center;justify-content:center;
  font-size:2.2rem;font-weight:700;color:#fff;
  box-shadow:0 4px 20px rgba(10,35,90,.3);
  margin-bottom:.8rem;font-family:'Playfair Display',serif;
}
.profile-name-display{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:500;margin-bottom:.2rem;text-align:center;}
.profile-role-badge{display:inline-block;background:var(--blue-pale);color:var(--blue);font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;padding:.22rem .7rem;border-radius:20px;}

/* Card */
.profile-card{background:#fff;border-radius:22px;overflow:hidden;box-shadow:var(--shadow-sm);border:1px solid var(--grey-mid);margin-bottom:1.2rem;}
.card-header{padding:1rem 1.5rem;border-bottom:1px solid var(--grey-mid);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.5rem;}
.card-header-title{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--blue);}
.card-body{padding:1.2rem 1.2rem;}

/* Info rows */
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:.85rem;}
.info-item{padding:.8rem;background:var(--grey-light);border-radius:12px;}
.info-label{font-size:.68rem;text-transform:uppercase;letter-spacing:.06em;color:var(--text-muted);font-weight:700;margin-bottom:.3rem;opacity:.7;}
.info-val{font-size:.92rem;font-weight:600;color:var(--black);word-break:break-word;}
.info-val.muted{color:var(--text-muted);font-weight:400;font-style:italic;}

/* Edit btn */
.edit-btn{background:var(--blue-pale);color:var(--blue);border:1.5px solid rgba(10,35,90,.15);padding:.45rem 1.1rem;border-radius:40px;font-size:.8rem;font-weight:700;transition:all .2s;display:inline-flex;align-items:center;gap:.4rem;}
.edit-btn:hover{background:var(--blue);color:#fff;border-color:var(--blue);}

/* Edit form */
.field-group{margin-bottom:1.1rem;}
.field-group label{display:block;font-size:.75rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.4rem;}
.field-wrap{position:relative;}
.field-icon{position:absolute;left:.9rem;top:50%;transform:translateY(-50%);color:#bbb;font-size:.85rem;}
.field-input{width:100%;padding:.7rem 1rem .7rem 2.4rem;border:1.5px solid var(--grey-mid);border-radius:12px;font-family:'DM Sans',sans-serif;font-size:.9rem;outline:none;background:var(--grey-light);color:var(--black);transition:border-color .2s,box-shadow .2s,background .2s;}
.field-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(10,35,90,.08);background:#fff;}
.field-input::placeholder{color:#bbb;}
.edit-success{background:#dcfce7;border:1px solid #bbf7d0;color:#166534;padding:.7rem 1rem;border-radius:10px;font-size:.83rem;margin-bottom:1rem;display:none;align-items:center;gap:.5rem;}
.edit-success.show{display:flex;}
.edit-error{background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:.7rem 1rem;border-radius:10px;font-size:.83rem;margin-bottom:1rem;display:none;align-items:center;gap:.5rem;}
.edit-error.show{display:flex;}

/* Buttons */
.form-actions{display:flex;gap:.7rem;margin-top:1.2rem;}
.save-btn{flex:2;background:linear-gradient(135deg,var(--blue) 0%,#1e4ab5 100%);color:#fff;border:none;padding:.75rem;border-radius:12px;font-size:.88rem;font-weight:700;transition:all .2s;box-shadow:0 2px 8px rgba(10,35,90,.25);}
.save-btn:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(10,35,90,.35);}
.save-btn:disabled{background:var(--grey-mid);color:var(--text-muted);box-shadow:none;transform:none;cursor:not-allowed;}
.cancel-btn{flex:1;background:none;border:1.5px solid var(--grey-mid);color:var(--text-muted);padding:.75rem;border-radius:12px;font-size:.88rem;font-weight:600;transition:all .2s;}
.cancel-btn:hover{border-color:var(--danger);color:var(--danger);}

/* Quick links */
.quick-links{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.75rem;}
.quick-link{background:#fff;border:1px solid var(--grey-mid);border-radius:14px;padding:.9rem;text-align:center;cursor:pointer;transition:all .22s;text-decoration:none;color:var(--black);display:block;}
.quick-link:hover{transform:translateY(-3px);box-shadow:var(--shadow-md);border-color:rgba(10,35,90,.1);}
.quick-link-icon{font-size:1.4rem;margin-bottom:.4rem;}
.quick-link-label{font-size:.8rem;font-weight:600;}
.quick-link-sub{font-size:.68rem;color:var(--text-muted);margin-top:.1rem;font-weight:300;}

/* Logout */
.logout-btn{width:100%;background:none;border:1.5px solid var(--grey-mid);color:var(--text-muted);padding:.75rem;border-radius:12px;font-size:.88rem;font-weight:600;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem;}
.logout-btn:hover{border-color:var(--danger);color:var(--danger);}

/* ‚ïê‚ïê RESPONSIVE ‚ïê‚ïê */
@media(max-width:600px){
  .profile-content{margin:1.2rem auto;padding:0 4% 2.5rem;}
  .card-body{padding:1rem;}
  .info-grid{grid-template-columns:1fr;}
  .quick-links{grid-template-columns:repeat(2,1fr);}
  .avatar-circle{width:76px;height:76px;font-size:1.9rem;}
  .profile-name-display{font-size:1.2rem;}
  .form-actions{flex-direction:column;}
  .save-btn,.cancel-btn{flex:none;}
}
@media(max-width:380px){
  .quick-links{grid-template-columns:repeat(2,1fr);}
  .quick-link{padding:.75rem .5rem;}
  .quick-link-icon{font-size:1.2rem;}
  .quick-link-sub{display:none;}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê NAV ‚ïê‚ïê -->
<nav id="mainNav">
  <a href="index.html" class="nav-logo">Volt<span>Edge</span></a>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="product.html">Products</a></li>
    <li><a href="newArrivals.html">New Arrivals</a></li>
    <li><a href="index.html#categories">Categories</a></li>
  </ul>
  <div class="nav-right-area">
    <a href="cart.html" style="font-size:.8rem;color:var(--blue);font-weight:500;">Cart</a>
    <a href="product.html" class="nav-cta">Shop Now</a>
    <button class="nav-hamburger" id="navHamburger" aria-label="Open menu" aria-expanded="false">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</nav>

<div class="nav-mobile-menu" id="navMobileMenu">
  <a href="index.html">Home</a>
  <a href="product.html">Products</a>
  <a href="newArrivals.html">New Arrivals</a>
  <a href="index.html#categories">Categories</a>
  <a href="cart.html">My Cart</a>
  <a href="product.html" class="mobile-cta">Shop Now</a>
</div>

<script>
window.addEventListener('scroll',()=>{document.getElementById('mainNav').style.padding=window.scrollY>40?'0.6rem 4%':'1rem 4%';});
const Auth={
  isLoggedIn:()=>!!localStorage.getItem('token'),
  headers:()=>({'Content-Type':'application/json','Authorization':`Bearer ${localStorage.getItem('token')}`}),
  logout:()=>{['token','userId','role','userName'].forEach(k=>localStorage.removeItem(k));window.location.href='login.html';}
};
if(!Auth.isLoggedIn())window.location.href='login.html?redirect=profile.html';

const ham=document.getElementById('navHamburger'),menu=document.getElementById('navMobileMenu');
ham.addEventListener('click',()=>{const o=menu.classList.toggle('open');ham.setAttribute('aria-expanded',o);ham.innerHTML=o?'<i class="fas fa-times"></i>':'<i class="fas fa-bars"></i>';});
document.addEventListener('click',e=>{if(!menu.contains(e.target)&&e.target!==ham&&!ham.contains(e.target)){menu.classList.remove('open');ham.setAttribute('aria-expanded',false);ham.innerHTML='<i class="fas fa-bars"></i>';}});
</script>

<div class="page-hero">
  <div class="breadcrumb"><a href="index.html">Home</a> / Profile</div>
  <h1>My Account</h1>
  <p>Manage your profile and preferences</p>
</div>

<div class="profile-content">
  <div class="loading-wrap" id="loadingMsg"><div class="spinner"></div> Loading your profile‚Ä¶</div>
  <div class="error-banner" id="errorMsg"><i class="fas fa-exclamation-circle"></i><span id="errorText"></span></div>

  <!-- Profile View -->
  <div id="profileView" style="display:none;">
    <div class="profile-avatar-wrap">
      <div class="avatar-circle" id="avatarCircle">?</div>
      <div class="profile-name-display" id="displayName">‚Äî</div>
      <span class="profile-role-badge" id="displayRole">User</span>
    </div>

    <div class="profile-card">
      <div class="card-header">
        <span class="card-header-title">Personal Information</span>
        <button class="edit-btn" id="editBtn"><i class="fas fa-pen"></i> Edit</button>
      </div>
      <div class="card-body">
        <div class="info-grid">
          <div class="info-item"><div class="info-label">First Name</div><div class="info-val" id="viewFirstName">‚Äî</div></div>
          <div class="info-item"><div class="info-label">Last Name</div><div class="info-val" id="viewLastName">‚Äî</div></div>
          <div class="info-item"><div class="info-label">Email</div><div class="info-val" id="viewEmail">‚Äî</div></div>
          <div class="info-item"><div class="info-label">Phone</div><div class="info-val" id="viewPhone">‚Äî</div></div>
        </div>
      </div>
    </div>

    <div class="profile-card">
      <div class="card-header"><span class="card-header-title">Quick Links</span></div>
      <div class="card-body">
        <div class="quick-links">
          <a href="cart.html" class="quick-link"><div class="quick-link-icon">üõí</div><div class="quick-link-label">My Cart</div><div class="quick-link-sub">View items</div></a>
          <a href="orders.html" class="quick-link"><div class="quick-link-icon">üì¶</div><div class="quick-link-label">Orders</div><div class="quick-link-sub">Track orders</div></a>
          <a href="product.html" class="quick-link"><div class="quick-link-icon">üõç</div><div class="quick-link-label">Shop</div><div class="quick-link-sub">Browse all</div></a>
          <a href="newArrivals.html" class="quick-link"><div class="quick-link-icon">‚ú®</div><div class="quick-link-label">New In</div><div class="quick-link-sub">Latest items</div></a>
        </div>
      </div>
    </div>

    <button class="logout-btn" onclick="Auth.logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>

  <!-- Profile Edit -->
  <div id="profileEdit" style="display:none;">
    <div class="profile-card">
      <div class="card-header"><span class="card-header-title">Edit Profile</span></div>
      <div class="card-body">
        <div class="edit-success" id="editSuccess"><i class="fas fa-check-circle"></i><span id="successText"></span></div>
        <div class="edit-error" id="editError"><i class="fas fa-exclamation-circle"></i><span id="editErrorText"></span></div>
        <div class="field-group">
          <label>First Name</label>
          <div class="field-wrap"><i class="fas fa-user field-icon"></i><input type="text" class="field-input" id="firstName" placeholder="First name" required></div>
        </div>
        <div class="field-group">
          <label>Last Name</label>
          <div class="field-wrap"><i class="fas fa-user field-icon"></i><input type="text" class="field-input" id="lastName" placeholder="Last name"></div>
        </div>
        <div class="field-group">
          <label>Phone</label>
          <div class="field-wrap"><i class="fas fa-phone field-icon"></i><input type="tel" class="field-input" id="phone" placeholder="+233 XX XXX XXXX" inputmode="tel"></div>
        </div>
        <div class="form-actions">
          <button class="cancel-btn" id="cancelBtn">Cancel</button>
          <button class="save-btn" id="saveBtn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const API_BASE='http://localhost:8080/api/v1';
let profileData=null;

async function loadProfile(){
  try{
    const res=await fetch(`${API_BASE}/user/profile`,{headers:Auth.headers()});
    if(!res.ok)throw new Error('Failed to load profile');
    profileData=await res.json();renderProfile();
  }catch(err){
    document.getElementById('loadingMsg').style.display='none';
    document.getElementById('errorText').textContent=err.message;
    document.getElementById('errorMsg').classList.add('show');
  }
}
function renderProfile(){
  document.getElementById('loadingMsg').style.display='none';
  document.getElementById('profileView').style.display='block';
  const fn=profileData.firstName||'';const ln=profileData.lastName||'';
  const initials=(fn.charAt(0)+(ln.charAt(0)||fn.charAt(1)||'')).toUpperCase()||'?';
  document.getElementById('avatarCircle').textContent=initials;
  document.getElementById('displayName').textContent=`${fn} ${ln}`.trim()||'‚Äî';
  document.getElementById('displayRole').textContent=profileData.role||'User';
  document.getElementById('viewFirstName').textContent=fn||'‚Äî';
  document.getElementById('viewLastName').textContent=ln||'‚Äî';
  document.getElementById('viewEmail').textContent=profileData.email||'‚Äî';
  document.getElementById('viewPhone').textContent=profileData.phone||'‚Äî';
}
document.getElementById('editBtn').addEventListener('click',()=>{
  document.getElementById('profileView').style.display='none';
  document.getElementById('profileEdit').style.display='block';
  document.getElementById('firstName').value=profileData.firstName||'';
  document.getElementById('lastName').value=profileData.lastName||'';
  document.getElementById('phone').value=profileData.phone||'';
  document.getElementById('editError').classList.remove('show');
  document.getElementById('editSuccess').classList.remove('show');
  window.scrollTo({top:0,behavior:'smooth'});
});
document.getElementById('cancelBtn').addEventListener('click',()=>{
  document.getElementById('profileEdit').style.display='none';
  document.getElementById('profileView').style.display='block';
});
document.getElementById('saveBtn').addEventListener('click',async()=>{
  const btn=document.getElementById('saveBtn');
  const errEl=document.getElementById('editError');const errText=document.getElementById('editErrorText');
  const sucEl=document.getElementById('editSuccess');const sucText=document.getElementById('successText');
  errEl.classList.remove('show');sucEl.classList.remove('show');
  btn.disabled=true;btn.textContent='Saving‚Ä¶';
  const payload={firstName:document.getElementById('firstName').value.trim(),lastName:document.getElementById('lastName').value.trim(),phone:document.getElementById('phone').value.trim()};
  try{
    const res=await fetch(`${API_BASE}/user/profile`,{method:'PUT',headers:Auth.headers(),body:JSON.stringify(payload)});
    if(!res.ok){const err=await res.json().catch(()=>({}));throw new Error(err.message||'Update failed');}
    profileData=await res.json();
    localStorage.setItem('userName',`${profileData.firstName} ${profileData.lastName||''}`.trim());
    sucText.textContent='Profile updated successfully!';sucEl.classList.add('show');
    renderProfile();
    setTimeout(()=>{document.getElementById('profileEdit').style.display='none';document.getElementById('profileView').style.display='block';},1500);
  }catch(err){errText.textContent=err.message;errEl.classList.add('show');}
  finally{btn.disabled=false;btn.textContent='Save Changes';}
});
loadProfile();
</script>
</body>
</html>